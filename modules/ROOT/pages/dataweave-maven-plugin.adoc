= Packaging and Deploying DataWeave Libraries

Use the DataWeave Maven plugin to integrate the packaging and deployment of your DataWeave libraries with your Maven lifecycle.

The DataWeave Maven plugin has six main goals you can run:

* `compile` +
Compiles the source code for your DataWeave library.

* `test` +
Tests the compiled source code using the https://github.com/mulesoft/data-weave-testing-framework[DataWeave Testing Framework].

* `data-weave:generate-docs` +
Automatically generates the documentation for your DataWeave library.

* `package` +
Packages the compiled code in a `JAR` file.

* `data-weave:deploy-docs` +
Uploads the auto-generated documentation for your DataWeave library to Anypoint Exchange.

* `deploy` +
Automatically uploads your DataWeave library to the deployment target and uploads the auto-generated documentation to Exchange.

== Add the DataWeave Maven Plugin to a Project

To enable the DataWeave Maven plugin in your project:

* Add the following Maven dependency to your project's `pom.xml` file:
+
[source,xml,linenums]
----
<plugin>
include::dataweave::partial$dataweave-maven-plugin-config.adoc[tag=config]
</plugin>
----

* Add the following repositories to your project's `pom.xml` file::
+
[source,xml,linenums]
----
<pluginRepositories>
    <pluginRepository>
        <id>mule-releases</id>
        <url>https://repository-master.mulesoft.org/nexus/content/repositories/releases</url>
    </pluginRepository>
    <pluginRepository>
        <id>mule-snapshots</id>
        <url>https://repository-master.mulesoft.org/nexus/content/repositories/snapshots</url>
    </pluginRepository>
</pluginRepositories>
----

== Compile a DataWeave Library

Run the `compile` goal to compile your DataWeave library from source code, for example:

[source,console,linenums]
----
mvn compile
----

== Test a DataWeave Library

Run the `test` goal to execute the DataWeave test suite included in your library, for example:

[source,console,linenums]
----
mvn test
----

The DataWeave Maven plugin uses the https://github.com/mulesoft/data-weave-testing-framework[DataWeave Testing Framework] to run your test suite, which supports configuring additional parameters when you run the `test` goal.

=== Configure the Test Suite

Inside the `plugin` configuration, add the `tests` element with your desired tests configuration.

*Configuration Parameters*

[%header%autowidth.spread,cols=".^a,.^a,.^a,.^a"]
|===
|Name |Type |Default |Description

|`output`
|`String`
|`${project.build.directory}/data-weave-test-reports`
|Specifies the path for the directory where all the auto-generated reports are created when the test runs.

|`htmlReport`
|`boolean`
|`true`
|When set to `true`, the test suite generate an HTML report for the execution.

|`coverageEnabled`
|`boolean`
|`false`
|When set to `true`, the test suite generate a coverage report for the execution.

|`coverageFormat`
|`String`
|`sonar`
|Specifies the format for the coverage report.

There are two valid formats:

* `sonar` +
Generates a valid https://www.sonarqube.org/[Sonar^] coverage report for your test suite.
* `html` +
Generates an HTML coverage report for your test suite.

|`runnerLogForkedProcessCommand`
|`boolean`
|`false`
|When set to `true`, logs the command used to launch the test runner process.

|`runnerEnvironmentVariables`
|`Map`
|`null`
|A set of additional environment variables to pass to the test runner process.

|`runnerSystemProperties`
|`Map`
|`null`
|A set of additional system properties to pass to the test runner process.

|`runnerArgLine`
|`boolean`
|`null`
|A set of additional JVM options to pass to the test runner process

|`runnerJvmDebug`
|`boolean`
|`false`
|When set to `true`, enables remote debugging for the test runner JVM.
|===

=== Test Configuration Example

The following example enables `sonar` coverage report and disables `htmlReport` in a project.

.Example `pom.xml` file
[source,xml,linenums]
----
<plugin>
include::dataweave::partial$dataweave-maven-plugin-config.adoc[tag=config]
  <configuration>
    ...
    <tests>
      <htmlReport>false</htmlReport>
      <coverageEnabled>true</coverageEnabled>
      <coverageFormat>sonar</coverageFormat>
    </tests>
    ...
  </configuration>
</plugin>
----

== Generate Documentation for a DataWeave Library

Run the `data-weave:generate-docs` goal to auto-generate the documentation for your DataWeave library, for example:

[source,console,linenums]
----
mvn prepare-package
----

Alternatively, you can also run:

[source,console,linenums]
----
mvn data-weave:generate-docs
----

=== Configure the Automated Docs Generation

Inside the `plugin` configuration, add the `docs` element with your desired documentation configuration.

*Configuration Parameters*

[%header%autowidth.spread,cols=".^a,.^a,.^a,.^a"]
|===
|Name |Type |Default | Description

|`output`
|`String`
|`${project.build.directory}/data-weave-docs`
|The output directory where the documentation files are created.

|`template`
|`String`
|`exchange_markdown`
|The template set to use for the auto-generated documentation.

The DataWeave Maven plugin supports 3 types of documentation templates:

* `exchange_markdown` +
Generates the documentation in Markdown format, compliant with https://anypoint.mulesoft.com/exchange/portals/anypoint-platform/f1e97bc6-315a-4490-82a7-23abe036327a.anypoint-platform/exchange-experience-api/[Exchange^].
* `markdown` +
Generates the documentation in Markdown format.
* `asciidoc` +
Generates the documenation in AsciiDoc format.

Valid values are: `exchange_markdown` or `markdown` or `asciidoc`.

|`homePage`
|`String`
|`null`
|Specifies the path to a custom Markdown file to add in the home page generated by the `markdown` or `exchange_markdown` template.

|`favicon`
|`String`
|`null`
|Specifies the path to the image file (`png` or `jpg`) to use as the asset icon in the Exchange portal.
|===

=== Docs Generation Example

The following example shows how to configure a custom home page and a specific favicon to include in the Exchange portal home page of your DataWeave library:

.Example `pom.xml` file:
[source,xml,linenums]
----
<plugin>
include::dataweave::partial$dataweave-maven-plugin-config.adoc[tag=config]
  <configuration>
    ...
    <docs>
      <homePage>${project.basedir}/README.md</homePage>
      <favicon>${project.basedir}/src/main/resources/favicon/parrot.jpg</favicon>
    </docs>
    ...
  </configuration>
</plugin>
----

== Deploy DataWeave Libraries and Documentation to Exchange

Run the `deploy` goal to deploy the DataWeave library to the deployment target and upload the generated documentation to Exchange, for example:

[source,console,linenums]
----
mvn deploy
----

Run the `data-weave:deploy-docs` goal to upload the generated documentation to Exchange, for example:

[source,console,linenums]
----
mvn data-weave:deploy-docs
----

=== Before You Deploy Libraries to Exchange

Before uploading DataWeave libraries to Exchange, ensure that the `pom.xml` file includes all MuleSoft repositories and your credentials for Maven to access the enterprise repository.

See xref:exchange::to-publish-assets-maven.adoc#publish-an-asset-to-exchange-using-maven[Publish an Asset to Exchange Using Maven] for instructions to set up your DataWeave library.

=== Skip Exchange Documentation Upload

You can skip the Exchange documentation upload when deploying a DataWeave project by setting the `skipDeployDocs` system property to `true`:

[source,console,linenums]
----
mvn deploy -DskipDeployDocs=true
----

== DataWeave Library Structure Reference

At design time, DataWeave libraries need the following basic components:

[%header%autowidth.spread,cols=".^a,.^a,.^a"]
|===
|Component |Type |Description

|`src`
|Folder
|The source directory for your DataWeave library’s productive source code and tests.

|`pom.xml`
|Descriptor
|The POM file of your DataWeave library.
This file describes all of your library’s required dependencies.
|===

== Source Directory Reference

The directory structure of a DataWeave library has the following main folders:

=== src/main

`src/main` is the root folder for all the productive source code of the DataWeave library.

//[cols="1a,1a,3a", options="header"]
[%header%autowidth.spread,cols=".^a,.^a,.^a"]
|===
|Folder |Folder Type |Description

|`src/main/dw`
|source
|The root folder of the DataWeave library source code files.

|`src/main/resources`
|resource
|Contains the application resources, such as XML, JSON, and properties files.
|===

=== src/test

`src/test` is the root folder for all the test source code of the DataWeave library.

//[cols="1a,1,3", options="header"]
[%header%autowidth.spread,cols=".^a,.^a,.^a"]
|===
|Folder |Folder Type |Description

|`src/test/dw`
|source
|The root folder of the test cases used to validate the DataWeave library.

|`src/test/resources`
|resource
|Contains resources, such as XML, JSON, and properties files.
This folder also contains files required to run your test suite.
|===

== See also

//add additional topics.
xref:dataweave-testing-framework.adoc[Testing DataWeave Libraries and Modules]
